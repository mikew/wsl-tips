#!/usr/bin/env bash
set -e

UNAME="mike"
USHELL="/bin/bash"

SYSTEMD_PID=$(pgrep -f -a "^/lib/systemd/systemd --system-unit=basic.target" | awk '{ print $1 }')

if [ -n "$SYSTEMD_PID" ] && [ "$SYSTEMD_PID" != "1" ]; then
  # exec sudo /usr/bin/nsenter -t "$SYSTEMD_PID" -a su - "$LOGNAME"
  exec sudo /usr/bin/nsenter \
    -t "$SYSTEMD_PID" \
    -a \
      runuser \
      -l \
      -s "$USHELL" \
      "$UNAME"
  # exec nsenter -t "${SYSTEMD_PID}" -m -p --wd="${PWD}" runuser -s "${USHELL}" "${UNAME}" -- "${@}"
fi
